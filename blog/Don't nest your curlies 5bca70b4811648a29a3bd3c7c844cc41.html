
    <!DOCTYPE html>
    <html>
        <head>
            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width">
            <title>Don't nest your curlies 5bca70b4811648a29a3bd3c7c844cc41</title>
            
            
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/open-fonts@1.1.1/fonts/inter.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css">
    <link rel="stylesheet" href="https://unpkg.com/github-syntax-dark@latest/lib/github-dark.css"/>
    
        </head>
        <body>
            <header>
                <nav>
                    <a href="https://patricktrainer.github.io/static-site">Home</a> /
                    <a href="https://github.com/patricktrainer">GitHub</a> / 
                </nav>
            </header>
            <h1>Don't nest your curlies</h1>
<p>Created: Mar 6, 2020 10:01 AM
URL: https://docs.getdbt.com/docs/dont-nest-your-curlies</p>
<p><strong>Don't Nest Your Curlies</strong></p>
<blockquote>
<p>If dbt errors out earlyand your models are building quite poorlydon't post to the slackjust take a step backand check if you're nesting your curlies.</p>
</blockquote>
<p>When writing jinja code in a dbt project, it may be tempting to nest expressions inside of each other. Take this example:</p>
<p><code>{{ dbt_utils.date_spine(
      datepart="day",
      start_date=[ USE JINJA HERE ]
      ) 
  }}</code></p>
<p>To nest a jinja expression inside of another jinja expression, simply place the desired code (without curly brackets) directly into the expression.</p>
<p><strong>Correct example</strong>
Here, the return value of the <code>var()</code> context method is supplied as the <code>start_date</code> argument to the <code>date_spine</code> macro. Great!</p>
<p><code>{{ dbt_utils.date_spine(
      datepart="day",
      start_date=var('start_date')
      ) 
  }}</code></p>
<p><strong>Incorrect example</strong><em>This code does not work in dbt &gt;= v0.15.0</em>. Once we've denoted that we're inside a jinja expression (using the <code>{{</code> syntax), no further curly brackets are required inside of the jinja expression. This code will supply a literal string value, <code>"{{ var('start_date') }}"</code>, as the <code>start_date</code> argument to the <code>date_spine</code> macro. This is probably not what you actually want to do!</p>
<p>```
-- Do not do this! It will not work!</p>
<p>{{ dbt_utils.date_spine(
      datepart="day",
      start_date="{{ var('start_date') }}"
      ) 
  }}
```</p>
<p>There is one exception to this rule: curlies inside of curlies are acceptable in hooks (ie. <code>on-run-start</code>, <code>on-run-end</code>, <code>pre-hook</code>, and <code>post-hook</code>).</p>
<p>Code like this is both valid, and encouraged:</p>
<p><code>{{ config(post_hook="grant select on {{ this }} to role bi_role") }}</code></p>
<p>So why are curlies inside of curlies allowed in this case? Here, we actually <em>want</em> the string literal <code>"grant select on {{ this }} ..."</code> to be saved as the configuration value for the post-hook in this model. This string will be re-rendered when the model runs, resulting in a sensible sql expressions like <code>grant select on "schema"."table"....</code> being executed against the database. These hooks are a special exception to the rule stated above.</p>
        </body>
    </html>
    