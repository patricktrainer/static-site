
    <!DOCTYPE html>
    <html>
        <head>
            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width">
            <title>Distill Why do we need Flask, Celery, and Redis (w f28fa7b5ecbc49a88d8eabdf1ba7f19c</title>
            
            
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/open-fonts@1.1.1/fonts/inter.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css">
    <link rel="stylesheet" href="https://unpkg.com/github-syntax-dark@latest/lib/github-dark.css"/>
    
        </head>
        <body>
            <header>
                <nav>
                    <a href="https://patricktrainer.github.io/static-site">Home</a> /
                    <a href="https://github.com/patricktrainer">GitHub</a> / 
                </nav>
            </header>
            <h1>Distill: Why do we need Flask, Celery, and Redis? (with McDonalds in Between)</h1>
<p>Created: Apr 18, 2020 6:19 AM
URL: https://ljvmiranda921.github.io/notebook/2019/11/08/flask-redis-celery-mcdo/</p>
<p>A few weeks ago, someone at work asked me:</p>
<p>![Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/scene_00.svg](Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/scene_00.svg)</p>
<p>Good question, And below is a longer version of my quick explanation back then.</p>
<p>There’s a wealth of resources and tutorials out there, but they mostly suffer from the <a href="https://en.wikipedia.org/wiki/Curse_of_knowledge">curse of knowledge</a>. This time, let’s step back and do an ELI5<a href="https://ljvmiranda921.github.io/notebook/2019/11/08/flask-redis-celery-mcdo/">1</a> on how these technologies relate to one another.</p>
<p>In this blogpost, I’ll explain why we need Flask, Celery, and Redis by sharing my adventures in buying McNuggets from Mcdonalds. Using these three (or technologies similar to them) is integral to web backend development so that we can scale our applications.</p>
<ul>
<li><a href="https://ljvmiranda921.github.io/notebook/2019/11/08/flask-redis-celery-mcdo/">Part 1: A Tale of Two Mcdonalds</a>. First, I’ll explain the concept and intuition of a task queue in order to motivate the technologies mentioned above.</li>
<li><a href="https://ljvmiranda921.github.io/notebook/2019/11/08/flask-redis-celery-mcdo/">Part 2: Diving into Mcdonalds Task Queue</a>. Then, we’ll look into the various components found in the Mcdonalds task queue and how they relate to one another.</li>
<li><a href="https://ljvmiranda921.github.io/notebook/2019/11/08/flask-redis-celery-mcdo/">Part 3: Stepping out of Mcdonalds</a>. In this section, we’ll abstract our knowledge of the task queue components so that we can apply them to systems outside Mcdo.</li>
<li><a href="https://ljvmiranda921.github.io/notebook/2019/11/08/flask-redis-celery-mcdo/">Part 4: Ye Old Switcheroo</a>. We’ll then substitute our previous knowledge of a task queue with Flask, Celery, and Redis. By this time, we should have an idea of how these technologies fall together.</li>
</ul>
<p>Ready? Let’s go!</p>
<h2>A Tale of Two McDonalds</h2>
<p>I love McNuggets, they’re always consistently good whichever Mcdonald’s store I go to. No matter what level of a cook you are, it’s impossible to mess up a fried nugget. Fortunately, there’s a McDonalds near my (A) apartment and my (B) office building.</p>
<p>Both serve delicious McNuggets, but <em>man</em>, I hate buying from the one near my apartment. The reason? <strong>The lines are too slow and long</strong>.</p>
<p>![Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/scene_01.svg](Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/scene_01.svg)</p>
<p>My usual order is a 6-pc. Chicken McNuggets. They don’t take a long time to prepare, but because there’s only one person who takes my order and processes it, my ordering time is affected by anyone who has lined-up before me. So if someone orders a ton (more food to prepare) during their turn, then I’m in for a waiting game.</p>
<p>![Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/scene_02.svg](Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/scene_02.svg)</p>
<p>In the Mcdo near my apartment: I need to wait for everyone who lined-up before me to finish and get their orders before I can start with mine.</p>
<p><strong>Now</strong>, the Mcdo near our office has solved this problem with a nifty trick:</p>
<p>![Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/scene_03.svg](Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/scene_03.svg)</p>
<p>First they take my order, but they don’t process it in front of me right away. Instead, they give me a <em>reference number</em> so that I can check the status of my order on a large display.</p>
<p>The large display is placed near the counter and it shows all reference numbers with their current status (i.e., Preparing, Ready). All I need to do is wait comfortably at the side and check if my order’s complete.</p>
<blockquote>
<p>In the Mcdo near my office: everyone receives a reference number after ordering. While my order is on queue, I can just relax on the side and check if it’s done processing.</p>
</blockquote>
<p>There are still some lines, but the waiting time is much shorter because I don’t need to wait for the person before me just to punch-in my request. Customers can easily track their orders using their reference number, so they just come back to the counter once they see that their order’s ready.</p>
<p>As we’ve seen, the Mcdonalds near our office has implemented something called a <strong>task queue.</strong> Having a task queue provided them with the following benefits:</p>
<ul>
<li><strong>Reduced waiting time for customers</strong>. By separating the person who processes the order and the one who prepares the food, the time-to-respond for each customer has been greatly reduced. For myself, I don’t need to wait for everyone in front of me to get their orders before I can start with mine.</li>
<li>
<p><strong>Better task delegation</strong>. The <em>Ate</em> or <em>Kuya</em> who takes my order is different from the one who prepares it. It’s less stress for both parties and each can just focus on doing their respective tasks!</p>
<p><a href="https://ljvmiranda921.github.io/notebook/2019/11/08/flask-redis-celery-mcdo/">2</a></p>
</li>
<li>
<p><strong>Customers can just sit back and relax</strong>. I don’t need to be anxious of the people behind me because once I received my reference number, I can just sit down and relax while waiting for my order to complete. I’ll just refer periodically to the LED screen to check if my McNugget’s ready.</p>
</li>
</ul>
<p>By this time, I hope you’re having a sense of what Flask, Celery, and Redis are trying to achieve— i.e., <strong>creating a task queue.</strong> In the next section, we’ll discuss the various components of Mcdonald’s task queue and how they map to the three technologies above.</p>
<h2>Diving into Mcdonald’s Task Queue</h2>
<p>In the Mcdonalds near our office, there are three major components that are in play:</p>
<ul>
<li><strong>The <em>Ate</em>/<em>Kuya</em> cashier</strong>: they’re the ones who talk to customers, take their orders, and give them their reference numbers <em>(remember that in the Mcdo near our apartment, they’re also the ones who prepares the meal, which is inefficient)</em>.</li>
<li><strong>The <em>Ate</em>/<em>Kuya</em> worker crew</strong>: they’re the ones who receives the placed order and prepares or cooks our meal.</li>
<li><strong>The database behind the LED screen</strong>: the LED screen displays information on the customers’ reference numbers and order status, but we know that it’s job is to <em>only show</em> information. The actual workhorse is the database behind it. Think of it as a large, invisible table that stores whatever the LED screen displays.</li>
</ul>
<p>![Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/cashier.svg](Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/cashier.svg)</p>
<p>All in all, we see that these components relate to one another via the illustration below:</p>
<p>![Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/task_queue_01.svg](Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/task_queue_01.svg)</p>
<ol>
<li>The customer talks to the cashier to place their order.</li>
<li>The cashier takes their order, put it in the database queue (with a <code>PENDING</code> status), so that free workers can take them on. The customer receives a reference number and sits on the side. The cashier is then free to take-on another order.</li>
<li>A free worker takes on the order and prepares the meal.</li>
<li>Once the worker is done preparing, he updates the status of the reference number from <code>PENDING</code> to <code>SUCCESS</code>.</li>
<li>The LED displays this change, and the customer sees that his order is now done preparing. He takes his order and goes on his merry way!</li>
</ol>
<p>So far we’ve familiarized ourselves with the concept of a task queue and how it plays out within the context of our favorite fastfood restaurant. Now, let’s step-out of Mcdonalds and start seeing these components in a more abstracted manner.</p>
<h2>Stepping-out of Mcdonalds</h2>
<p>![Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/land_of_abstraction.svg](Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/land_of_abstraction.svg)</p>
<p>Ok, so we’re out of Mcdonalds. Let’s stop thinking about cashiers and LED screens and start thinking in more abstract components. Here’s the same task queue but from the Land of Abstraction:</p>
<p>![Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/task_queue_02.svg](Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/task_queue_02.svg)</p>
<p>We consider ourselves as the <strong><a href="https://en.wikipedia.org/wiki/Client%E2%80%93server_model">Client</a></strong>, for we’re the ones asking for a service or making a <strong>Request</strong>.<a href="https://ljvmiranda921.github.io/notebook/2019/11/08/flask-redis-celery-mcdo/">3</a> The cashier crew and the LED screen that we interact with is the <strong>Application</strong>.</p>
<p>Notice that I lumped the cashier crew and the LED screen together? It’s because these are the two interfaces that we interact with during our time in Mcdo. The LED screen is just a conduit of the actual database that stores and manages data behind it (the <strong>Database Backend</strong>). Lastly, the actual processes that take our request and make something out of it are called our <strong>Workers</strong>.</p>
<p>So far, we’ve learned the following:</p>
<ul>
<li>What a task queue is and why it’s important.</li>
<li>The components of the Mcdonald’s task queue: cashier, worker, database behind LED screen</li>
<li>How these components look like in more general terms: application, worker, database backend.</li>
</ul>
<p>The table below maps the Mcdonalds components that we currently know to the abstract general component that we’re going to use from this point forward. Now, we’re ready to use what we know so far and map these components to Flask, Celery, and Redis!</p>
<p>[Untitled](Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/Untitled%20Database%20c3d33a065be34178b63bf9ef5a5aa481.csv)</p>
<h2>Ye Old Switcheroo</h2>
<p>This should be simple now, so here’s ye old switcheroo!</p>
<p>![Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/switcheroo.svg](Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/switcheroo.svg)</p>
<p>[Untitled](Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/Untitled%20Database%20e3c404ffa74b4de58589fc30cbef5bd0.csv)</p>
<p><em>See what we did there?</em> We just switched-out the components of the Mcdonalds task queue to its web backend counterpart. To see them in action, let’s look at the illustration below:</p>
<p>![Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/task_queue_03.svg](Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/task_queue_03.svg)</p>
<ul>
<li><strong>Flask Application</strong>. This the web application that accepts requests and returns responses depending on that request. When you talk to the cashier, you make a request (likely a <code>[/POST](https://en.wikipedia.org/wiki/POST_(HTTP))</code>). When you look at the LED screen, you’re also making a request (likely a <code>[/GET](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods)</code>).</li>
<li><strong>Celery Worker</strong>. Workers run the processes in your web application: classifying an image, processing an email, and much more! Celery provides the framework to write workers for running your services. Remember, <strong>celery is not just the worker</strong>. It is a framework that allows your workers to communicate with the database backend, “talk” to one another and the like. A celery worker is just one piece of the Celery “ecosystem”.</li>
<li><strong>Redis</strong>. This one holds information on the reference numbers (also known as IDs) and status of each job. Redis is an in-memory data store, think of global variables on steroids. Perhaps, the <em>actual</em> database backend in Mcdonalds is built on-top of Redis. Truth is, you can swap-out Redis with any other data storage you can think of, like MySQL, PostgresSQL, and the like.</li>
</ul>
<p>Together, these three form a task queuing system. What happens then is:</p>
<ol>
<li>The Client talks to the Flask Application to place their request.</li>
<li>The App takes the request, put it in the database queue (with a <code>PENDING</code> status), so that Celery workers can take them on. The Client receives a JobID and polls on the side. The App is then free to take-on the next request.</li>
<li>A Celery worker takes on the request and runs the service.</li>
<li>Once the worker is done, it updates the job’s status from <code>PENDING</code> to <code>SUCCESS</code>.</li>
<li>The App signals this change (or returned when polled), and the Client sees that his request is now done processing. He takes his response and goes on his merry way!</li>
</ol>
<h3>I forgot to tell you something</h3>
<p>As we now know, <a href="http://www.celeryproject.org/">Celery</a> acts as the framework that brings all the components above together. This includes your Flask Application, the Database Backend, and the Workers. <em>I forgot to tell you something</em>, there’s another important component, the <strong>Message queue</strong>.</p>
<p>Simply put, you can think of this as the squiggly lines that connect these services together. For Celery, technologies that can act as a messaging queue are Redis, RabbitMQ, Memcache, and the like. You can see a <a href="http://docs.celeryproject.org/en/latest/getting-started/brokers/">list of technologies</a> here.</p>
<h3>Is it really just Flask, Celery, and Redis?</h3>
<p>From our land of abstraction, we knew that the task queue is a general approach to solve a problem and we just substituted (<em>switcheroo’d</em>) various technologies to fulfill such roles. We can definitely use a variety of tech for each component. For example, we can use MySQL as our database backend and RabbitMQ as our message queue. We still achieve the same thing, but with different technologies.</p>
<h2>Conclusion</h2>
<p>In this blog post, I showed how Flask, Celery, and Redis work together to form a task queue. We then learned the following:</p>
<ul>
<li>What a task queue is and why it’s important to our systems.</li>
<li>The general components of a task queue and how these components relate to one another.</li>
<li>How Flask, Celery, and Redis fit into these general components to fulfill their roles.</li>
</ul>
<p>We also learned that systems like these require a messaging queue (squiggly lines) and that it’s possible to switch-out these technologies with other frameworks while achieving the same goal. Hope this fun blog post shed some light on backend web development, please let me know if any concepts I’ve missed in this Distill!</p>
<p>![Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/something_new.svg](Distill%20Why%20do%20we%20need%20Flask,%20Celery,%20and%20Redis%20(w%20f28fa7b5ecbc49a88d8eabdf1ba7f19c/something_new.svg)</p>
<ol>
<li>
<p><em>Ate</em> means older sister while <em>Kuya</em> means older brother in Filipino. For those who are not from the Philippines, we usually call everyone (even our fastfood service crews) as older brothers and sisters. <a href="https://ljvmiranda921.github.io/notebook/2019/11/08/flask-redis-celery-mcdo/">↩</a></p>
</li>
<li>
<p>This is definitely a hand-wavy definition of what a Client does. In client-server architectures, you have someone who provides a resource or service (Server) and the one who asks for it (Client). <a href="https://ljvmiranda921.github.io/notebook/2019/11/08/flask-redis-celery-mcdo/">↩</a></p>
</li>
</ol>
        </body>
    </html>
    